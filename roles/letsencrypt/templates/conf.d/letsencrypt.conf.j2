{{ ansible_managed | comment }}

ssl_certificate {{ letsencrypt_folder }}/live/{{ ansible_fqdn }}/fullchain.pem;
ssl_certificate_key {{ letsencrypt_folder }}live/{{ ansible_fqdn }}/privkey.pem;

server {
  listen      80;
  server_name "~^(.+\.)?{{ ansible_fqdn }}$";

  location /.well-known/acme-challenge {
    root {{ letsencrypt_challenge_directory }};
  }

  if ($request_uri !~* "well-known/acme-challenge") {
    return 301 https://$host$request_uri;
  }
}
